b4w.register("Bedroom Survey",function(Q,e){function R(a,c){c?(E.create_preloader(),a.addEventListener("mousedown",F),a.addEventListener("touchstart",F),a.addEventListener("mouseup",G),a.addEventListener("touchend",G),a.addEventListener("mousemove",H),a.addEventListener("touchmove",H),window.onresize=A.resize_to_container,A.resize_to_container(),l.load(p+"environment.json",S,T)):console.log("b4w init failure")}function T(a){E.update_preloader(a)}function S(){t.enable_camera_controls(!1,!1,!1,A.get_canvas());
U();var a=g.get_object_by_name("spawner");h.get_translation(a,B)}function U(){var a=document.getElementById("spinner-container"),c=document.getElementById("item-container");document.getElementById("controls-container").style.display="block";c.style.display="block";V();document.getElementById("load-1").addEventListener("click",function(){a.style.display="block";l.load(p+"bed.json",u,null,null,!0);q.push("Q")});document.getElementById("load-2").addEventListener("click",function(){a.style.display="block";
l.load(p+"dresser.json",u,null,null,!0);q.push("D")});document.getElementById("load-3").addEventListener("click",function(){a.style.display="block";l.load(p+"bookshelf.json",u,null,null,!0);q.push("B")});document.getElementById("load-4").addEventListener("click",function(){a.style.display="block";l.load(p+"nightstand.json",u,null,null,!0);q.push("N")});document.getElementById("load-5").addEventListener("click",function(){a.style.display="block";l.load(p+"desk.json",u,null,null,!0);q.push("W")});document.getElementById("load-7").addEventListener("click",
function(){var a=k.get_selectable_objects(),d="$",c=!1,f=q.slice(0);v.sort();v.reverse();for(var e=0;e<v.length;e++)f.splice(v[e],1);for(e=0;e<a.length;e++){var g=a[e];1==m.get_sensor_value(g,"COLLISION",0)&&(c=!0);g=h.get_object_bounding_box(g);d=d+f[e]+","+g.min_x.toFixed(3)+","+g.max_x.toFixed(3)+","+g.min_y.toFixed(3)+","+g.max_y.toFixed(3)+","+g.min_z.toFixed(3)+","+g.max_z.toFixed(3)+"$"}0==c?prompt("Here is your result! Please copy (CTRL+C) and paste into survey.",d):window.alert("Please ensure there are no overlapping objects and try again.")});
document.getElementById("delete").addEventListener("click",function(){if(f){var a=g.get_object_data_id(f);v.push(a-1);l.unload(a);f=null}});document.getElementById("rot-ccw").addEventListener("click",function(){f&&I(f,J)});document.getElementById("rot-cw").addEventListener("click",function(){f&&I(f,-J)})}function V(){for(var a=["delete","rot-ccw","rot-cw"],c=0;c<a.length;c++){var b=a[c];document.getElementById(b).addEventListener("mousedown",function(a){a.target.parentNode.classList.add("active")});
document.getElementById(b).addEventListener("mouseup",function(a){a.target.parentNode.classList.remove("active")});document.getElementById(b).addEventListener("touchstart",function(a){a.target.parentNode.classList.add("active")});document.getElementById(b).addEventListener("touchend",function(a){a.target.parentNode.classList.remove("active")})}}function u(a){var c=document.getElementById("spinner-container");a=g.get_all_objects("ALL",a);for(var b=0;b<a.length;b++){var d=a[b];if(K.has_physics(d)){K.enable_simulation(d);
var e=m.create_collision_sensor(d,"FURNITURE"),l=m.create_selection_sensor(d,!0);d==f&&m.set_custom_sensor(l,1);m.create_sensor_manifold(d,"COLLISION",m.CT_CONTINUOUS,[e,l],W,X);(e=k.get_parent(d))&&k.is_armature(e)?h.set_translation_v(e,B):h.set_translation_v(d,B)}k.is_mesh(d)&&(g.show_object(d),c.style.display="none")}}function W(a){return a[1]}function X(a,c,b){1==b&&(m.get_sensor_value(a,c,0)?g.set_outline_color(Y):g.set_outline_color(Z))}function I(a,c){var b=k.get_parent(a);if(b&&k.is_armature(b)){var d=
h.get_rotation(b,L);M.rotateZ(d,c,d);h.set_rotation_v(b,d)}else d=h.get_rotation(a,L),M.rotateZ(d,c,d),h.set_rotation_v(a,d);N(a)}function F(a){C=!0;a.preventDefault&&a.preventDefault();var c=x.get_coords_x(a);a=x.get_coords_y(a);var b=g.pick_object(c,a);f!=b&&(f&&g.clear_outline_anim(f),b&&g.apply_outline_anim(b,1,1,0),f=b);if(f){var b=g.get_active_camera(),d=k.get_parent(f);d&&k.is_armature(d)?h.get_translation(d,r):h.get_translation(f,r);O.project_point(b,r,n);n[0]=c-n[0];n[1]=a-n[1]}}function G(){C=
!1;y||(t.enable_camera_controls(),y=!0)}function H(a){if(C&&f){y&&(t.disable_camera_controls(),y=!1);var c=g.get_active_camera(),b=x.get_coords_x(a);a=x.get_coords_y(a);0<=b&&0<=a&&(b-=n[0],a-=n[1],b=O.calc_ray(c,b,a,z),b=w.get_pline_directional_vec(b,r),c=h.get_translation(c,aa),w.set_pline_initial_point(z,c),w.set_pline_directional_vec(z,b),(c=w.line_plane_intersect(ba,0,z,ca))&&0>b[2]&&((b=k.get_parent(f))&&k.is_armature(b)?h.set_translation_v(b,c):h.set_translation_v(f,c),N(f)))}}function N(a){var c=
h.get_object_bounding_box(a),b=k.get_parent(a),d=b&&k.is_armature(b)?h.get_translation(b,r):h.get_translation(a,r);3.35<c.max_x?d[0]-=c.max_x-3.35:0>c.min_x&&(d[0]+=0-c.min_x);3.048<c.max_y?d[1]-=c.max_y-3.048:0>c.min_y&&(d[1]+=0-c.min_y);b&&k.is_armature(b)?h.set_translation_v(b,d):h.set_translation_v(a,d)}var t=e("app"),O=e("camera"),da=e("config"),A=e("container"),m=e("controls"),l=e("data"),x=e("mouse"),w=e("math"),k=e("objects"),K=e("physics"),E=e("preloader"),g=e("scenes"),h=e("transform"),
P=e("version"),P=e("version"),M=e("quat"),D="DEBUG"===P.type(),Z=[0,1,0],Y=[1,0,0],ba=[0,0,1],J=Math.PI/2,p=da.get_std_assets_path("Bedroom Survey"),n=new Float32Array(2),B=new Float32Array(3),r=new Float32Array(3),aa=new Float32Array(3),ca=new Float32Array(3),L=new Float32Array(4),z=w.create_pline(),C=!1,y=!0,q=[],v=[],f=null;Q.init=function(){var a=D,c=t.get_url_params();c&&"show_fps"in c&&(a=!0);t.init({canvas_container_id:"main_canvas_container",callback:R,physics_enabled:!0,show_fps:a,alpha:!1,
assets_dds_available:!D,assets_min50_available:!D,background_color:[1,1,1,0]})}});b4w.require("Bedroom Survey").init();
